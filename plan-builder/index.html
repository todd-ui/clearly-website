<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DYZ1XEXPMT"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-DYZ1XEXPMT');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Build Your Custody Plan - Free Plan Builder | Clearly</title>
  <meta name="description" content="Create a professional custody schedule in minutes. Free tool to build your co-parenting plan with schedule patterns, holidays, and expenses.">
  <link rel="canonical" href="https://getclearly.app/plan-builder/">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://getclearly.app/plan-builder/">
  <meta property="og:title" content="Build Your Custody Plan - Free Plan Builder">
  <meta property="og:description" content="Create a professional custody schedule in minutes. Free tool for co-parents.">
  <meta property="og:image" content="https://dwncravjhkbclbuzijra.supabase.co/storage/v1/object/public/Clearly%20Logos/icon.png">
  <meta property="og:site_name" content="Clearly">
  <link rel="icon" href="https://dwncravjhkbclbuzijra.supabase.co/storage/v1/object/public/Clearly%20Logos/favicon.png">
  <link rel="apple-touch-icon" href="https://dwncravjhkbclbuzijra.supabase.co/storage/v1/object/public/Clearly%20Logos/icon.png">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #0D8268;
      --primary-light: #14b89a;
      --primary-soft: rgba(13, 130, 104, 0.1);
      --bg: #FAFAF9;
      --surface: #FFFFFF;
      --border: #E8E7E4;
      --text: #1A1917;
      --text-secondary: #5C5856;
      --text-muted: #9A9894;
      --you-color: #0D8268;
      --coparent-color: #E8E7E4;
      --error: #DC2626;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Progress Bar */
    .progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--border);
      z-index: 100;
    }
    .progress-fill {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    /* Header */
    .wizard-header {
      position: fixed;
      top: 4px;
      left: 0;
      right: 0;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 99;
      background: var(--bg);
    }
    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 14px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.2s;
    }
    .back-btn:hover {
      background: var(--surface);
      color: var(--text);
    }
    .back-btn.hidden { visibility: hidden; }
    .step-counter {
      font-size: 14px;
      color: var(--text-muted);
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      color: var(--text);
      font-weight: 600;
    }
    .logo img {
      width: 32px;
      height: 32px;
      border-radius: 8px;
    }

    /* Main Container */
    .wizard-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 100px 24px 120px;
    }
    .wizard-content {
      max-width: 640px;
      margin: 0 auto;
      width: 100%;
    }

    /* Screens */
    .screen {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .screen.active { display: block; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Typography */
    h1 {
      font-size: 36px;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 12px;
    }
    h2 {
      font-size: 28px;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 12px;
    }
    .subtitle {
      font-size: 18px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 32px;
    }
    .section-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    /* Cards */
    .pathway-cards {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 24px;
    }
    @media (max-width: 600px) {
      .pathway-cards { grid-template-columns: 1fr; }
    }
    .pathway-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }
    .pathway-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }
    .pathway-card.selected {
      border-color: var(--primary);
      background: var(--primary-soft);
    }
    .pathway-card h3 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .pathway-card p {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    .pathway-icon {
      width: 48px;
      height: 48px;
      background: var(--primary-soft);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      color: var(--primary);
    }

    /* Chips */
    .chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 16px 0;
    }
    .chip {
      padding: 12px 20px;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 100px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .chip:hover {
      border-color: var(--primary);
    }
    .chip.selected {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    /* Inputs */
    .input-group {
      margin-bottom: 24px;
    }
    .input-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    .text-input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      transition: border-color 0.2s;
    }
    .text-input:focus {
      outline: none;
      border-color: var(--primary);
    }
    .text-input::placeholder {
      color: var(--text-muted);
    }

    /* Children Cards */
    .children-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 24px;
    }
    .child-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
    }
    .child-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }
    .child-avatar {
      width: 40px;
      height: 40px;
      background: var(--primary-soft);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-weight: 600;
    }
    .child-number {
      font-weight: 600;
      color: var(--text-secondary);
    }
    .remove-child {
      margin-left: auto;
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 4px;
    }
    .remove-child:hover { color: var(--error); }

    /* Schedule Cards */
    .schedule-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 24px;
    }
    @media (max-width: 600px) {
      .schedule-grid { grid-template-columns: 1fr; }
    }
    .schedule-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .schedule-card:hover {
      border-color: var(--primary);
    }
    .schedule-card.selected {
      border-color: var(--primary);
      background: var(--primary-soft);
    }
    .schedule-card h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .schedule-card .split {
      font-size: 13px;
      color: var(--primary);
      font-weight: 500;
      margin-bottom: 12px;
    }
    .mini-calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 2px;
    }
    .mini-day {
      aspect-ratio: 1;
      border-radius: 4px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mini-day.you { background: var(--you-color); color: white; }
    .mini-day.coparent { background: var(--coparent-color); }

    /* Calendar Preview */
    .calendar-preview {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-top: 24px;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .calendar-nav {
      display: flex;
      gap: 8px;
    }
    .calendar-nav button {
      width: 36px;
      height: 36px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--surface);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .calendar-nav button:hover {
      background: var(--bg);
    }
    .calendar-month {
      font-weight: 600;
      font-size: 16px;
    }
    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 8px;
    }
    .calendar-weekday {
      text-align: center;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      padding: 8px 0;
    }
    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }
    .calendar-day {
      aspect-ratio: 1;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .calendar-day.empty { cursor: default; }
    .calendar-day.you {
      background: var(--you-color);
      color: white;
    }
    .calendar-day.coparent {
      background: var(--coparent-color);
      color: var(--text-secondary);
    }
    .calendar-day.today {
      box-shadow: inset 0 0 0 2px var(--primary);
    }
    .calendar-day.holiday::after {
      content: '';
      position: absolute;
      bottom: 2px;
      width: 4px;
      height: 4px;
      background: var(--primary);
      border-radius: 50%;
    }
    .calendar-legend {
      display: flex;
      gap: 20px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-secondary);
    }
    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 4px;
    }
    .legend-dot.you { background: var(--you-color); }
    .legend-dot.coparent { background: var(--coparent-color); }

    /* Holiday List */
    .holiday-section {
      margin-top: 24px;
    }
    .holiday-group {
      margin-bottom: 24px;
    }
    .holiday-group-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    .holiday-group-title svg {
      transition: transform 0.2s;
    }
    .holiday-group.collapsed .holiday-group-title svg {
      transform: rotate(-90deg);
    }
    .holiday-group.collapsed .holiday-items {
      display: none;
    }
    .holiday-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .holiday-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .holiday-name {
      font-size: 15px;
      font-weight: 500;
    }
    .holiday-chips {
      display: flex;
      gap: 6px;
    }
    .holiday-chip {
      padding: 6px 12px;
      border-radius: 100px;
      font-size: 12px;
      font-weight: 500;
      border: 1px solid var(--border);
      background: var(--surface);
      cursor: pointer;
      transition: all 0.15s;
    }
    .holiday-chip:hover {
      border-color: var(--primary);
    }
    .holiday-chip.selected {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    /* Expense Split */
    .split-bar {
      height: 24px;
      background: var(--coparent-color);
      border-radius: 12px;
      overflow: hidden;
      margin: 16px 0;
    }
    .split-fill {
      height: 100%;
      background: var(--you-color);
      transition: width 0.3s;
    }
    .split-labels {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* Review Summary */
    .summary-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
    }
    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .summary-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
    }
    .summary-edit {
      font-size: 13px;
      color: var(--primary);
      cursor: pointer;
      background: none;
      border: none;
    }
    .summary-edit:hover {
      text-decoration: underline;
    }
    .summary-content {
      font-size: 16px;
      line-height: 1.6;
    }
    .summary-list {
      list-style: none;
    }
    .summary-list li {
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }
    .summary-list li:last-child {
      border-bottom: none;
    }

    /* Plan Code Display */
    .plan-code-card {
      background: var(--primary-soft);
      border: 2px solid var(--primary);
      border-radius: 16px;
      padding: 32px;
      text-align: center;
      margin: 24px 0;
    }
    .plan-code-label {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    .plan-code {
      font-size: 36px;
      font-weight: 700;
      font-family: monospace;
      color: var(--primary);
      letter-spacing: 4px;
    }
    .copy-btn {
      margin-top: 16px;
      padding: 10px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }
    .copy-btn:hover {
      background: var(--primary-light);
    }

    /* Footer Actions */
    .wizard-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 16px 24px;
      background: var(--bg);
      border-top: 1px solid var(--border);
      z-index: 99;
    }
    .footer-content {
      max-width: 640px;
      margin: 0 auto;
      display: flex;
      gap: 12px;
    }
    .btn {
      flex: 1;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      text-decoration: none;
    }
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
    }
    .btn-primary:hover {
      background: var(--primary-light);
    }
    .btn-primary:disabled {
      background: var(--border);
      color: var(--text-muted);
      cursor: not-allowed;
    }
    .btn-secondary {
      background: var(--surface);
      color: var(--text);
      border: 2px solid var(--border);
    }
    .btn-secondary:hover {
      border-color: var(--text-secondary);
    }

    /* Responsive */
    @media (max-width: 600px) {
      h1 { font-size: 28px; }
      h2 { font-size: 24px; }
      .wizard-container { padding: 80px 16px 100px; }
      .wizard-header { padding: 12px 16px; }
      .wizard-footer { padding: 12px 16px; }
    }
  </style>
</head>
<body>
  <!-- Progress Bar -->
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill" style="width: 10%"></div>
  </div>

  <!-- Header -->
  <header class="wizard-header">
    <button class="back-btn hidden" id="backBtn" onclick="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
      Back
    </button>
    <span class="step-counter" id="stepCounter">Step 1 of 10</span>
    <a href="/" class="logo">
      <img src="https://dwncravjhkbclbuzijra.supabase.co/storage/v1/object/public/Clearly%20Logos/icon.png" alt="Clearly">
      <span>Clearly</span>
    </a>
  </header>

  <!-- Main Content -->
  <main class="wizard-container">
    <div class="wizard-content">

      <!-- Screen 1: Welcome -->
      <div class="screen active" id="screen-welcome">
        <h1>Build Your Custody Plan</h1>
        <p class="subtitle">Create a clear, professional custody schedule in minutes â€” free.</p>

        <p class="section-label">Choose your path</p>
        <div class="pathway-cards">
          <div class="pathway-card" onclick="selectPathway('explore')">
            <div class="pathway-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            </div>
            <h3>I'm exploring options</h3>
            <p>Get personalized schedule suggestions based on your family</p>
          </div>
          <div class="pathway-card" onclick="selectPathway('agreement')">
            <div class="pathway-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
            </div>
            <h3>I have an agreement</h3>
            <p>Enter your existing custody terms to create your plan</p>
          </div>
        </div>
      </div>

      <!-- Screen 2: Children -->
      <div class="screen" id="screen-children">
        <h2>Tell us about your children</h2>
        <p class="subtitle">This helps us personalize schedule recommendations.</p>

        <p class="input-label">How many children?</p>
        <div class="chip-group" id="childCountChips">
          <button class="chip" onclick="setChildCount(1)">1</button>
          <button class="chip" onclick="setChildCount(2)">2</button>
          <button class="chip" onclick="setChildCount(3)">3</button>
          <button class="chip" onclick="setChildCount(4)">4</button>
          <button class="chip" onclick="setChildCount(5)">5+</button>
        </div>

        <div class="children-list" id="childrenList"></div>
      </div>

      <!-- Screen 3: Schedule Selection -->
      <div class="screen" id="screen-schedule">
        <h2 id="scheduleTitle">Select your custody schedule</h2>
        <p class="subtitle" id="scheduleSubtitle">Choose the pattern that matches your agreement.</p>

        <div class="schedule-grid" id="scheduleGrid"></div>
      </div>

      <!-- Screen 4: Configure Schedule -->
      <div class="screen" id="screen-configure">
        <h2>Configure your schedule</h2>
        <p class="subtitle" id="configureSubtitle">Set up the details for your custody pattern.</p>

        <div id="configureOptions"></div>

        <div class="calendar-preview" id="schedulePreview">
          <div class="calendar-header">
            <span class="calendar-month" id="calendarMonth">January 2026</span>
            <div class="calendar-nav">
              <button onclick="prevMonth()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
              </button>
              <button onclick="nextMonth()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
              </button>
            </div>
          </div>
          <div class="calendar-weekdays">
            <div class="calendar-weekday">Sun</div>
            <div class="calendar-weekday">Mon</div>
            <div class="calendar-weekday">Tue</div>
            <div class="calendar-weekday">Wed</div>
            <div class="calendar-weekday">Thu</div>
            <div class="calendar-weekday">Fri</div>
            <div class="calendar-weekday">Sat</div>
          </div>
          <div class="calendar-days" id="calendarDays"></div>
          <div class="calendar-legend">
            <div class="legend-item">
              <div class="legend-dot you"></div>
              <span>Your time</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot coparent"></div>
              <span>Co-parent's time</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Screen 5: Holidays -->
      <div class="screen" id="screen-holidays">
        <h2>Holiday schedule</h2>
        <p class="subtitle">Assign custody for major holidays.</p>

        <p class="input-label">Quick setup</p>
        <div class="chip-group">
          <button class="chip selected" onclick="setHolidayPreset('alternate')">Alternate all</button>
          <button class="chip" onclick="setHolidayPreset('split')">Fixed split</button>
          <button class="chip" onclick="setHolidayPreset('custom')">Customize each</button>
        </div>

        <div class="holiday-section" id="holidaySection"></div>
      </div>

      <!-- Screen 6: Summer -->
      <div class="screen" id="screen-summer">
        <h2>Summer schedule</h2>
        <p class="subtitle">Do you have a different schedule during summer?</p>

        <div class="chip-group">
          <button class="chip" onclick="setSummerSchedule(false)">No, same schedule</button>
          <button class="chip" onclick="setSummerSchedule(true)">Yes, different schedule</button>
        </div>

        <div id="summerOptions" style="display: none;">
          <div class="input-group" style="margin-top: 24px;">
            <label class="input-label">Summer starts</label>
            <input type="date" class="text-input" id="summerStart">
          </div>
          <div class="input-group">
            <label class="input-label">Summer ends</label>
            <input type="date" class="text-input" id="summerEnd">
          </div>
          <p class="input-label">Summer pattern</p>
          <div class="chip-group">
            <button class="chip selected" onclick="setSummerPattern('same')">Same as regular</button>
            <button class="chip" onclick="setSummerPattern('alternating-weeks')">Alternating weeks</button>
            <button class="chip" onclick="setSummerPattern('alternating-2weeks')">Alternating 2 weeks</button>
          </div>
        </div>
      </div>

      <!-- Screen 7: Expenses -->
      <div class="screen" id="screen-expenses">
        <h2>Expense sharing</h2>
        <p class="subtitle">How do you split shared expenses?</p>

        <p class="input-label">Split ratio</p>
        <div class="chip-group" id="expenseChips">
          <button class="chip selected" onclick="setExpenseSplit(50)">50/50</button>
          <button class="chip" onclick="setExpenseSplit(60)">60/40</button>
          <button class="chip" onclick="setExpenseSplit(70)">70/30</button>
          <button class="chip" onclick="setExpenseSplit(0)">Custom</button>
        </div>

        <div class="split-bar">
          <div class="split-fill" id="splitFill" style="width: 50%"></div>
        </div>
        <div class="split-labels">
          <span>You: <strong id="yourSplit">50%</strong></span>
          <span>Co-parent: <strong id="coparentSplit">50%</strong></span>
        </div>

        <div class="input-group" style="margin-top: 32px;">
          <p class="input-label">Categories to track (optional)</p>
          <div class="chip-group">
            <button class="chip selected" onclick="toggleCategory(this, 'medical')">Medical</button>
            <button class="chip selected" onclick="toggleCategory(this, 'education')">Education</button>
            <button class="chip" onclick="toggleCategory(this, 'activities')">Activities</button>
            <button class="chip" onclick="toggleCategory(this, 'clothing')">Clothing</button>
            <button class="chip" onclick="toggleCategory(this, 'childcare')">Childcare</button>
          </div>
        </div>
      </div>

      <!-- Screen 8: Review -->
      <div class="screen" id="screen-review">
        <h2>Review your plan</h2>
        <p class="subtitle">Make sure everything looks right before saving.</p>

        <div id="reviewContent"></div>

        <div class="calendar-preview" style="margin-top: 24px;">
          <div class="calendar-header">
            <span class="calendar-month" id="reviewCalendarMonth">January 2026</span>
            <div class="calendar-nav">
              <button onclick="prevReviewMonth()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
              </button>
              <button onclick="nextReviewMonth()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
              </button>
            </div>
          </div>
          <div class="calendar-weekdays">
            <div class="calendar-weekday">Sun</div>
            <div class="calendar-weekday">Mon</div>
            <div class="calendar-weekday">Tue</div>
            <div class="calendar-weekday">Wed</div>
            <div class="calendar-weekday">Thu</div>
            <div class="calendar-weekday">Fri</div>
            <div class="calendar-weekday">Sat</div>
          </div>
          <div class="calendar-days" id="reviewCalendarDays"></div>
          <div class="calendar-legend">
            <div class="legend-item">
              <div class="legend-dot you"></div>
              <span>Your time</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot coparent"></div>
              <span>Co-parent's time</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Screen 9: Email Capture -->
      <div class="screen" id="screen-email">
        <h2>Save your plan</h2>
        <p class="subtitle">Enter your email to get your Plan Code and a copy of your plan.</p>

        <div class="input-group">
          <label class="input-label">Email address</label>
          <input type="email" class="text-input" id="emailInput" placeholder="you@example.com">
        </div>
        <div class="input-group">
          <label class="input-label">First name (optional)</label>
          <input type="text" class="text-input" id="nameInput" placeholder="Your name">
        </div>
      </div>

      <!-- Screen 10: Plan Code -->
      <div class="screen" id="screen-complete">
        <h2>Your plan is ready!</h2>
        <p class="subtitle">Use this code to import your plan into the Clearly app.</p>

        <div class="plan-code-card">
          <p class="plan-code-label">Your Plan Code</p>
          <p class="plan-code" id="planCode">ABC12345</p>
          <button class="copy-btn" onclick="copyPlanCode()">Copy Code</button>
        </div>

        <div class="summary-section">
          <h3 style="margin-bottom: 16px;">Next steps</h3>
          <ol style="padding-left: 20px; line-height: 2;">
            <li>Download Clearly from the App Store</li>
            <li>Create your account</li>
            <li>Enter your Plan Code during setup</li>
            <li>Your schedule is automatically configured!</li>
          </ol>
        </div>

        <a href="https://apps.apple.com/app/clearly" target="_blank" class="btn btn-primary" style="display: block; margin-top: 24px;">
          Download Clearly
        </a>

        <p style="text-align: center; margin-top: 16px; font-size: 14px; color: var(--text-secondary);">
          Share this code with your co-parent so you both have the same schedule.
        </p>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="wizard-footer" id="wizardFooter">
    <div class="footer-content">
      <button class="btn btn-primary" id="continueBtn" onclick="nextScreen()">Continue</button>
    </div>
  </footer>

  <script>
    // ==========================================
    // STATE MANAGEMENT
    // ==========================================
    const state = {
      currentScreen: 0,
      pathway: null, // 'explore' or 'agreement'
      children: [],
      schedule: null,
      scheduleConfig: {
        startsWith: 'you',
        referenceDate: null,
        exchangeTime: '18:00'
      },
      holidays: {},
      summer: {
        enabled: false,
        startDate: null,
        endDate: null,
        pattern: 'same'
      },
      expenses: {
        split: 50,
        categories: ['medical', 'education']
      },
      email: '',
      name: '',
      planCode: null
    };

    const screens = [
      'welcome', 'children', 'schedule', 'configure',
      'holidays', 'summer', 'expenses', 'review', 'email', 'complete'
    ];

    // ==========================================
    // SCHEDULE PATTERNS
    // ==========================================
    const schedulePatterns = [
      {
        id: 'week-on-week-off',
        name: 'Week On / Week Off',
        split: '50/50',
        pattern: [1,1,1,1,1,1,1,0,0,0,0,0,0,0], // 1 = you, 0 = coparent
        description: 'Alternating full weeks. Great for older kids who benefit from stability.',
        forAges: ['6-12', '13-17']
      },
      {
        id: '5-2-2-5',
        name: '5-2-2-5',
        split: '50/50',
        pattern: [1,1,1,1,1,0,0,0,0,1,1,0,0,0],
        description: 'You have Mon-Fri one week, then just the weekend the next.',
        forAges: ['2-5', '6-12']
      },
      {
        id: '2-2-3',
        name: '2-2-3',
        split: '50/50',
        pattern: [1,1,0,0,1,1,1,0,0,1,1,0,0,0],
        description: 'Shorter rotations mean more frequent contact with both parents.',
        forAges: ['under-2', '2-5']
      },
      {
        id: '3-4-4-3',
        name: '3-4-4-3',
        split: '50/50',
        pattern: [1,1,1,0,0,0,0,0,0,0,0,1,1,1],
        description: 'Balanced mid-week and weekend time for both parents.',
        forAges: ['2-5', '6-12']
      },
      {
        id: '4-3',
        name: '4-3',
        split: '57/43',
        pattern: [1,1,1,1,0,0,0],
        description: 'One parent has 4 days, the other has 3. Repeats weekly.',
        forAges: ['6-12', '13-17']
      },
      {
        id: 'every-other-weekend',
        name: 'Every Other Weekend',
        split: '70/30',
        pattern: [0,0,0,0,0,1,1,0,0,0,0,0,0,0],
        description: 'Primary parent has weekdays, other parent has every other weekend.',
        forAges: ['under-2', '2-5']
      },
      {
        id: 'every-weekend',
        name: 'Every Weekend',
        split: '71/29',
        pattern: [0,0,0,0,0,1,1],
        description: 'Primary parent has weekdays, other parent has every weekend.',
        forAges: ['6-12', '13-17']
      },
      {
        id: 'custom',
        name: 'Custom Schedule',
        split: 'Varies',
        pattern: [],
        description: 'Build your own pattern day by day.',
        forAges: []
      }
    ];

    // ==========================================
    // HOLIDAYS DATA
    // ==========================================
    const holidays = {
      major: [
        { id: 'thanksgiving', name: 'Thanksgiving' },
        { id: 'christmas-eve', name: 'Christmas Eve' },
        { id: 'christmas-day', name: 'Christmas Day' },
        { id: 'new-years-eve', name: "New Year's Eve" },
        { id: 'new-years-day', name: "New Year's Day" }
      ],
      spring: [
        { id: 'easter', name: 'Easter' },
        { id: 'memorial-day', name: 'Memorial Day' },
        { id: 'july-4th', name: 'July 4th' },
        { id: 'labor-day', name: 'Labor Day' }
      ],
      other: [
        { id: 'halloween', name: 'Halloween' },
        { id: 'mothers-day', name: "Mother's Day" },
        { id: 'fathers-day', name: "Father's Day" },
        { id: 'spring-break', name: 'Spring Break' }
      ]
    };

    // ==========================================
    // NAVIGATION
    // ==========================================
    function updateUI() {
      // Update screens
      document.querySelectorAll('.screen').forEach((screen, index) => {
        screen.classList.toggle('active', index === state.currentScreen);
      });

      // Update progress
      const progress = ((state.currentScreen + 1) / screens.length) * 100;
      document.getElementById('progressFill').style.width = `${progress}%`;

      // Update step counter
      document.getElementById('stepCounter').textContent =
        `Step ${state.currentScreen + 1} of ${screens.length}`;

      // Update back button
      const backBtn = document.getElementById('backBtn');
      backBtn.classList.toggle('hidden', state.currentScreen === 0);

      // Update continue button
      const continueBtn = document.getElementById('continueBtn');
      const footer = document.getElementById('wizardFooter');

      if (state.currentScreen === screens.length - 1) {
        footer.style.display = 'none';
      } else {
        footer.style.display = 'block';
        continueBtn.textContent = state.currentScreen === screens.length - 2 ? 'Get Plan Code' : 'Continue';
      }

      // Update continue button state
      updateContinueButton();
    }

    function updateContinueButton() {
      const btn = document.getElementById('continueBtn');
      let enabled = true;

      switch (screens[state.currentScreen]) {
        case 'welcome':
          enabled = state.pathway !== null;
          break;
        case 'children':
          enabled = state.children.length > 0;
          break;
        case 'schedule':
          enabled = state.schedule !== null;
          break;
        case 'email':
          const email = document.getElementById('emailInput')?.value || '';
          enabled = email.includes('@') && email.includes('.');
          break;
      }

      btn.disabled = !enabled;
    }

    function nextScreen() {
      if (state.currentScreen < screens.length - 1) {
        // Handle special cases before advancing
        if (screens[state.currentScreen] === 'email') {
          state.email = document.getElementById('emailInput').value;
          state.name = document.getElementById('nameInput').value;
          generatePlanCode();
        }

        state.currentScreen++;
        initScreen(screens[state.currentScreen]);
        updateUI();
        window.scrollTo(0, 0);
      }
    }

    function goBack() {
      if (state.currentScreen > 0) {
        state.currentScreen--;
        updateUI();
        window.scrollTo(0, 0);
      }
    }

    function goToScreen(screenName) {
      const index = screens.indexOf(screenName);
      if (index !== -1) {
        state.currentScreen = index;
        initScreen(screenName);
        updateUI();
        window.scrollTo(0, 0);
      }
    }

    // ==========================================
    // SCREEN INITIALIZERS
    // ==========================================
    function initScreen(screenName) {
      switch (screenName) {
        case 'schedule':
          renderScheduleGrid();
          break;
        case 'configure':
          renderConfigureOptions();
          renderCalendar();
          break;
        case 'holidays':
          renderHolidays();
          break;
        case 'review':
          renderReview();
          renderReviewCalendar();
          break;
      }
    }

    // ==========================================
    // WELCOME SCREEN
    // ==========================================
    function selectPathway(pathway) {
      state.pathway = pathway;
      document.querySelectorAll('.pathway-card').forEach(card => {
        card.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');
      updateContinueButton();

      // Auto-advance after selection
      setTimeout(() => nextScreen(), 300);
    }

    // ==========================================
    // CHILDREN SCREEN
    // ==========================================
    function setChildCount(count) {
      // Update chips
      document.querySelectorAll('#childCountChips .chip').forEach((chip, index) => {
        chip.classList.toggle('selected', index + 1 === count);
      });

      // Adjust children array
      while (state.children.length < count) {
        state.children.push({ name: '', age: null });
      }
      while (state.children.length > count) {
        state.children.pop();
      }

      renderChildrenList();
      updateContinueButton();
    }

    function renderChildrenList() {
      const container = document.getElementById('childrenList');
      container.innerHTML = state.children.map((child, index) => `
        <div class="child-card">
          <div class="child-card-header">
            <div class="child-avatar">${index + 1}</div>
            <span class="child-number">Child ${index + 1}</span>
            ${state.children.length > 1 ? `
              <button class="remove-child" onclick="removeChild(${index})">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
              </button>
            ` : ''}
          </div>
          <div class="input-group" style="margin-bottom: 16px;">
            <label class="input-label">Name (optional)</label>
            <input type="text" class="text-input" placeholder="Child's name"
              value="${child.name}"
              onchange="updateChildName(${index}, this.value)">
          </div>
          <p class="input-label">Age</p>
          <div class="chip-group">
            <button class="chip ${child.age === 'under-2' ? 'selected' : ''}" onclick="setChildAge(${index}, 'under-2')">Under 2</button>
            <button class="chip ${child.age === '2-5' ? 'selected' : ''}" onclick="setChildAge(${index}, '2-5')">2-5</button>
            <button class="chip ${child.age === '6-12' ? 'selected' : ''}" onclick="setChildAge(${index}, '6-12')">6-12</button>
            <button class="chip ${child.age === '13-17' ? 'selected' : ''}" onclick="setChildAge(${index}, '13-17')">13-17</button>
          </div>
        </div>
      `).join('');
    }

    function updateChildName(index, name) {
      state.children[index].name = name;
    }

    function setChildAge(index, age) {
      state.children[index].age = age;
      renderChildrenList();
      updateContinueButton();
    }

    function removeChild(index) {
      state.children.splice(index, 1);
      renderChildrenList();
      updateContinueButton();
    }

    // ==========================================
    // SCHEDULE SCREEN
    // ==========================================
    function renderScheduleGrid() {
      const container = document.getElementById('scheduleGrid');

      // Update title based on pathway
      if (state.pathway === 'explore') {
        document.getElementById('scheduleTitle').textContent = 'Recommended schedules';
        document.getElementById('scheduleSubtitle').textContent =
          'Based on your family, here are some options that work well.';
      }

      // Filter/sort patterns based on children ages if exploring
      let patterns = [...schedulePatterns];
      if (state.pathway === 'explore' && state.children.length > 0) {
        const ages = state.children.map(c => c.age).filter(Boolean);
        // Sort to show recommended patterns first
        patterns.sort((a, b) => {
          const aMatch = ages.some(age => a.forAges.includes(age));
          const bMatch = ages.some(age => b.forAges.includes(age));
          if (aMatch && !bMatch) return -1;
          if (!aMatch && bMatch) return 1;
          return 0;
        });
      }

      container.innerHTML = patterns.map(pattern => `
        <div class="schedule-card ${state.schedule === pattern.id ? 'selected' : ''}"
          onclick="selectSchedule('${pattern.id}')">
          <h4>${pattern.name}</h4>
          <p class="split">${pattern.split}</p>
          ${pattern.pattern.length > 0 ? `
            <div class="mini-calendar">
              ${pattern.pattern.slice(0, 14).map(day => `
                <div class="mini-day ${day === 1 ? 'you' : 'coparent'}"></div>
              `).join('')}
            </div>
          ` : ''}
          <p style="font-size: 13px; color: var(--text-secondary); margin-top: 12px;">${pattern.description}</p>
        </div>
      `).join('');
    }

    function selectSchedule(scheduleId) {
      state.schedule = scheduleId;
      renderScheduleGrid();
      updateContinueButton();

      // Auto-advance after selection
      setTimeout(() => nextScreen(), 300);
    }

    // ==========================================
    // CONFIGURE SCREEN
    // ==========================================
    let calendarMonth = new Date().getMonth();
    let calendarYear = new Date().getFullYear();

    function renderConfigureOptions() {
      const container = document.getElementById('configureOptions');
      const pattern = schedulePatterns.find(p => p.id === state.schedule);

      if (!pattern || pattern.id === 'custom') {
        container.innerHTML = `
          <p style="color: var(--text-secondary);">Custom schedule builder coming soon. For now, select a preset pattern.</p>
        `;
        return;
      }

      container.innerHTML = `
        <div class="input-group">
          <p class="input-label">Who has the children first?</p>
          <div class="chip-group">
            <button class="chip ${state.scheduleConfig.startsWith === 'you' ? 'selected' : ''}"
              onclick="setStartsWith('you')">You</button>
            <button class="chip ${state.scheduleConfig.startsWith === 'coparent' ? 'selected' : ''}"
              onclick="setStartsWith('coparent')">Co-parent</button>
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Exchange time</label>
          <input type="time" class="text-input" value="${state.scheduleConfig.exchangeTime}"
            onchange="setExchangeTime(this.value)" style="max-width: 200px;">
        </div>
      `;
    }

    function setStartsWith(who) {
      state.scheduleConfig.startsWith = who;
      renderConfigureOptions();
      renderCalendar();
    }

    function setExchangeTime(time) {
      state.scheduleConfig.exchangeTime = time;
    }

    function renderCalendar() {
      const container = document.getElementById('calendarDays');
      const monthLabel = document.getElementById('calendarMonth');

      const date = new Date(calendarYear, calendarMonth, 1);
      monthLabel.textContent = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

      const firstDay = date.getDay();
      const daysInMonth = new Date(calendarYear, calendarMonth + 1, 0).getDate();
      const today = new Date();

      let html = '';

      // Empty cells for days before the 1st
      for (let i = 0; i < firstDay; i++) {
        html += '<div class="calendar-day empty"></div>';
      }

      // Days of the month
      for (let day = 1; day <= daysInMonth; day++) {
        const currentDate = new Date(calendarYear, calendarMonth, day);
        const custody = getCustodyForDate(currentDate);
        const isToday = currentDate.toDateString() === today.toDateString();

        html += `<div class="calendar-day ${custody} ${isToday ? 'today' : ''}">${day}</div>`;
      }

      container.innerHTML = html;
    }

    function getCustodyForDate(date) {
      const pattern = schedulePatterns.find(p => p.id === state.schedule);
      if (!pattern || pattern.pattern.length === 0) return 'coparent';

      // Calculate day index based on a reference date
      const referenceDate = new Date(2026, 0, 1); // Jan 1, 2026
      const daysDiff = Math.floor((date - referenceDate) / (1000 * 60 * 60 * 24));
      const patternIndex = ((daysDiff % pattern.pattern.length) + pattern.pattern.length) % pattern.pattern.length;

      let isYou = pattern.pattern[patternIndex] === 1;
      if (state.scheduleConfig.startsWith === 'coparent') {
        isYou = !isYou;
      }

      return isYou ? 'you' : 'coparent';
    }

    function prevMonth() {
      calendarMonth--;
      if (calendarMonth < 0) {
        calendarMonth = 11;
        calendarYear--;
      }
      renderCalendar();
    }

    function nextMonth() {
      calendarMonth++;
      if (calendarMonth > 11) {
        calendarMonth = 0;
        calendarYear++;
      }
      renderCalendar();
    }

    // ==========================================
    // HOLIDAYS SCREEN
    // ==========================================
    function setHolidayPreset(preset) {
      document.querySelectorAll('#screen-holidays .chip-group .chip').forEach(chip => {
        chip.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');

      // Set defaults based on preset
      const allHolidays = [...holidays.major, ...holidays.spring, ...holidays.other];
      allHolidays.forEach((h, index) => {
        if (preset === 'alternate') {
          state.holidays[h.id] = index % 2 === 0 ? 'you-odd' : 'coparent-odd';
        } else if (preset === 'split') {
          state.holidays[h.id] = index % 2 === 0 ? 'you' : 'coparent';
        }
      });

      renderHolidays();
    }

    function renderHolidays() {
      const container = document.getElementById('holidaySection');

      const renderGroup = (title, items, collapsed = false) => `
        <div class="holiday-group ${collapsed ? 'collapsed' : ''}">
          <div class="holiday-group-title" onclick="toggleHolidayGroup(this)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
            ${title}
          </div>
          <div class="holiday-items">
            ${items.map(h => `
              <div class="holiday-row">
                <span class="holiday-name">${h.name}</span>
                <div class="holiday-chips">
                  <button class="holiday-chip ${state.holidays[h.id] === 'you' ? 'selected' : ''}"
                    onclick="setHoliday('${h.id}', 'you')">You</button>
                  <button class="holiday-chip ${state.holidays[h.id] === 'coparent' ? 'selected' : ''}"
                    onclick="setHoliday('${h.id}', 'coparent')">Co-parent</button>
                  <button class="holiday-chip ${state.holidays[h.id]?.includes('odd') ? 'selected' : ''}"
                    onclick="setHoliday('${h.id}', 'you-odd')">Alternate</button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;

      container.innerHTML = `
        ${renderGroup('Major Holidays', holidays.major)}
        ${renderGroup('Spring & Summer', holidays.spring, true)}
        ${renderGroup('Other', holidays.other, true)}
      `;
    }

    function toggleHolidayGroup(el) {
      el.parentElement.classList.toggle('collapsed');
    }

    function setHoliday(holidayId, value) {
      state.holidays[holidayId] = value;
      renderHolidays();
    }

    // ==========================================
    // SUMMER SCREEN
    // ==========================================
    function setSummerSchedule(enabled) {
      state.summer.enabled = enabled;
      document.querySelectorAll('#screen-summer > .chip-group .chip').forEach((chip, index) => {
        chip.classList.toggle('selected', (index === 0 && !enabled) || (index === 1 && enabled));
      });
      document.getElementById('summerOptions').style.display = enabled ? 'block' : 'none';
    }

    function setSummerPattern(pattern) {
      state.summer.pattern = pattern;
      document.querySelectorAll('#summerOptions .chip-group .chip').forEach(chip => {
        chip.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');
    }

    // ==========================================
    // EXPENSES SCREEN
    // ==========================================
    function setExpenseSplit(split) {
      if (split === 0) {
        // Custom - prompt for input
        const custom = prompt('Enter your percentage (0-100):');
        if (custom && !isNaN(custom)) {
          split = Math.min(100, Math.max(0, parseInt(custom)));
        } else {
          return;
        }
      }

      state.expenses.split = split;
      document.getElementById('splitFill').style.width = `${split}%`;
      document.getElementById('yourSplit').textContent = `${split}%`;
      document.getElementById('coparentSplit').textContent = `${100 - split}%`;

      document.querySelectorAll('#expenseChips .chip').forEach(chip => {
        chip.classList.remove('selected');
        if (chip.textContent === `${split}/${100-split}`) {
          chip.classList.add('selected');
        }
      });
    }

    function toggleCategory(el, category) {
      el.classList.toggle('selected');
      const index = state.expenses.categories.indexOf(category);
      if (index > -1) {
        state.expenses.categories.splice(index, 1);
      } else {
        state.expenses.categories.push(category);
      }
    }

    // ==========================================
    // REVIEW SCREEN
    // ==========================================
    let reviewCalendarMonth = new Date().getMonth();
    let reviewCalendarYear = new Date().getFullYear();

    function renderReview() {
      const container = document.getElementById('reviewContent');
      const pattern = schedulePatterns.find(p => p.id === state.schedule);

      const childrenNames = state.children
        .map((c, i) => c.name || `Child ${i + 1}`)
        .join(', ');

      const childrenAges = state.children
        .map(c => c.age || 'Age not set')
        .join(', ');

      container.innerHTML = `
        <div class="summary-section">
          <div class="summary-header">
            <span class="summary-title">Children</span>
            <button class="summary-edit" onclick="goToScreen('children')">Edit</button>
          </div>
          <div class="summary-content">
            <p><strong>${childrenNames}</strong></p>
            <p style="color: var(--text-secondary); font-size: 14px;">Ages: ${childrenAges}</p>
          </div>
        </div>

        <div class="summary-section">
          <div class="summary-header">
            <span class="summary-title">Custody Schedule</span>
            <button class="summary-edit" onclick="goToScreen('schedule')">Edit</button>
          </div>
          <div class="summary-content">
            <p><strong>${pattern?.name || 'Not selected'}</strong> (${pattern?.split || ''})</p>
            <p style="color: var(--text-secondary); font-size: 14px;">
              ${state.scheduleConfig.startsWith === 'you' ? 'You start' : 'Co-parent starts'}
              â€¢ Exchanges at ${formatTime(state.scheduleConfig.exchangeTime)}
            </p>
          </div>
        </div>

        <div class="summary-section">
          <div class="summary-header">
            <span class="summary-title">Holidays</span>
            <button class="summary-edit" onclick="goToScreen('holidays')">Edit</button>
          </div>
          <div class="summary-content">
            <p style="color: var(--text-secondary); font-size: 14px;">
              ${Object.keys(state.holidays).length} holidays configured
            </p>
          </div>
        </div>

        <div class="summary-section">
          <div class="summary-header">
            <span class="summary-title">Expenses</span>
            <button class="summary-edit" onclick="goToScreen('expenses')">Edit</button>
          </div>
          <div class="summary-content">
            <p><strong>${state.expenses.split}/${100-state.expenses.split} split</strong></p>
            <p style="color: var(--text-secondary); font-size: 14px;">
              Categories: ${state.expenses.categories.join(', ') || 'None selected'}
            </p>
          </div>
        </div>
      `;
    }

    function formatTime(time) {
      if (!time) return '6:00 PM';
      const [hours, minutes] = time.split(':');
      const h = parseInt(hours);
      const ampm = h >= 12 ? 'PM' : 'AM';
      const hour = h % 12 || 12;
      return `${hour}:${minutes} ${ampm}`;
    }

    function renderReviewCalendar() {
      const container = document.getElementById('reviewCalendarDays');
      const monthLabel = document.getElementById('reviewCalendarMonth');

      const date = new Date(reviewCalendarYear, reviewCalendarMonth, 1);
      monthLabel.textContent = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

      const firstDay = date.getDay();
      const daysInMonth = new Date(reviewCalendarYear, reviewCalendarMonth + 1, 0).getDate();
      const today = new Date();

      let html = '';

      for (let i = 0; i < firstDay; i++) {
        html += '<div class="calendar-day empty"></div>';
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const currentDate = new Date(reviewCalendarYear, reviewCalendarMonth, day);
        const custody = getCustodyForDate(currentDate);
        const isToday = currentDate.toDateString() === today.toDateString();

        html += `<div class="calendar-day ${custody} ${isToday ? 'today' : ''}">${day}</div>`;
      }

      container.innerHTML = html;
    }

    function prevReviewMonth() {
      reviewCalendarMonth--;
      if (reviewCalendarMonth < 0) {
        reviewCalendarMonth = 11;
        reviewCalendarYear--;
      }
      renderReviewCalendar();
    }

    function nextReviewMonth() {
      reviewCalendarMonth++;
      if (reviewCalendarMonth > 11) {
        reviewCalendarMonth = 0;
        reviewCalendarYear++;
      }
      renderReviewCalendar();
    }

    // ==========================================
    // PLAN CODE GENERATION
    // ==========================================
    function generatePlanCode() {
      // Generate a random 8-character code
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      let code = '';
      for (let i = 0; i < 8; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      state.planCode = code;
      document.getElementById('planCode').textContent = code;

      // TODO: Save to Supabase and send email
      savePlanToServer();
    }

    async function savePlanToServer() {
      // This would call your Supabase edge function
      console.log('Saving plan:', {
        code: state.planCode,
        email: state.email,
        name: state.name,
        plan: {
          children: state.children,
          schedule: state.schedule,
          scheduleConfig: state.scheduleConfig,
          holidays: state.holidays,
          summer: state.summer,
          expenses: state.expenses
        }
      });

      // For now, just log it - implement actual API call later
    }

    function copyPlanCode() {
      navigator.clipboard.writeText(state.planCode);
      const btn = event.currentTarget;
      btn.textContent = 'Copied!';
      setTimeout(() => {
        btn.textContent = 'Copy Code';
      }, 2000);
    }

    // ==========================================
    // EMAIL VALIDATION
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
      const emailInput = document.getElementById('emailInput');
      if (emailInput) {
        emailInput.addEventListener('input', updateContinueButton);
      }
    });

    // ==========================================
    // INIT
    // ==========================================
    updateUI();
  </script>
</body>
</html>
